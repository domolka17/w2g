{"ast":null,"code":"import _slicedToArray from\"D:/wum/w2g/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/**\r\n *  Chat window\r\n *  TODO manages Chat\r\n *  TODO uses get and posts\r\n *  TODO exports it selfe, needs css style\r\n *  TODO writing message and submit it\r\n * \r\n */import React,{useEffect,useState}from'react';import{chatPost}from'./Controller/ChatController';import\"./css/Chat.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Chat=function Chat(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messageList=_useState2[0],getListData=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),chatData=_useState6[0],getChatData=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),userData=_useState8[0],getUserData=_useState8[1];var roomname=sessionStorage.getItem('roomname');useEffect(function(){var interval=setInterval(function(){fetchChatData(roomname);fetchUserData(roomname);console.log('Update Chat');},3000);return function(){return clearInterval(interval);};},[]);useEffect(function(){console.log(chatData);if(chatData.length>0){var temp=[];for(var i=0;i<chatData.length;i++){var user=getUserName(chatData[i]);temp[i]={author:user,text:chatData[i].text,time:chatData[i].time};}getListData(temp);}},[chatData]);useEffect(function(){console.log(messageList);},[messageList]);// submit message button\nvar handleButton=function handleButton(){chatPost(message,sessionStorage.getItem('roomname'));// after posting message, emptys message-input\nsetTimeout(function(){setMessage('');},500);};var getUserName=function getUserName(userID){var user=userData.find(function(item){return item.id==userID.userId;});var ret;if(user==undefined){console.log(user);ret='deleted User';}else{ret=user.name;}return ret;};//____________________________\nvar fetchChatData=function fetchChatData(roomname){fetch('https://gruppe13.toni-barth.com/rooms/'+roomname+'/chat',{method:'GET'}).then(function(res){return res.json();}).then(function(response){getChatData(response.messages);});};var fetchUserData=function fetchUserData(roomname){fetch('https://gruppe13.toni-barth.com/rooms/'+roomname+'/users').then(function(res){return res.json();}).then(function(response){getUserData(response.users);});};return/*#__PURE__*/_jsxs(\"div\",{className:\"ChatBox\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"messageBox\",children:messageList.map(function(line){return/*#__PURE__*/_jsx(\"ul\",{className:\"massage\",children:line.author+': '+line.text},line.time);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ChatSubmitbar\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",class:\"message_submit\",placeholder:\"Nachricht schreiben\",value:message,onChange:function onChange(change){return setMessage(change.target.value);}}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(event){return handleButton();},className:\"message_submit_button\",children:\"Senden\"})]})]});};export default Chat;","map":{"version":3,"names":["React","useEffect","useState","chatPost","Chat","messageList","getListData","message","setMessage","chatData","getChatData","userData","getUserData","roomname","sessionStorage","getItem","interval","setInterval","fetchChatData","fetchUserData","console","log","clearInterval","length","temp","i","user","getUserName","author","text","time","handleButton","setTimeout","userID","find","item","id","userId","ret","undefined","name","fetch","method","then","res","json","response","messages","users","map","line","change","target","value","event"],"sources":["D:/wum/w2g/src/components/Chat.js"],"sourcesContent":["/**\r\n *  Chat window\r\n *  TODO manages Chat\r\n *  TODO uses get and posts\r\n *  TODO exports it selfe, needs css style\r\n *  TODO writing message and submit it\r\n * \r\n */\r\n\r\nimport React, { useEffect, useState } from 'react'\r\nimport {  chatPost } from './Controller/ChatController'\r\nimport \"./css/Chat.css\";\r\n\r\n\r\nconst Chat = () => {\r\n    const [messageList, getListData]= useState([])\r\n    const [message, setMessage] = useState('')\r\n    const [chatData, getChatData]= useState([])\r\n    const [userData, getUserData] = useState([])\r\n    const roomname = sessionStorage.getItem('roomname')\r\n\r\n    useEffect(() => {\r\n\r\n   \r\n        const interval = setInterval(() => {\r\n                fetchChatData(roomname)\r\n                fetchUserData(roomname)\r\n                console.log('Update Chat')\r\n\t\t}, 3000);\r\n\t\treturn () => clearInterval(interval);\r\n\t}, []);\r\n\r\n    useEffect(()=>{\r\n        console.log(chatData)\r\n        if(chatData.length>0){\r\n            let temp =[]\r\n            for(let i = 0; i<chatData.length; i++) {\r\n                const user = getUserName(chatData[i])\r\n                temp[i]=  { author: user, text: chatData[i].text, time: chatData[i].time}\r\n            }\r\n            getListData(temp)\r\n        }\r\n    }, [chatData]);\r\n\r\n    useEffect(()=>{\r\n        console.log(messageList)\r\n    }, [messageList]);\r\n\r\n\r\n    // submit message button\r\n    const handleButton = ()=>{\r\n        chatPost(message, sessionStorage.getItem('roomname'))\r\n        // after posting message, emptys message-input\r\n        setTimeout(function () {\r\n            setMessage('')\r\n        }, 500)\r\n    }\r\n    const getUserName=(userID)=>{\r\n        const user = userData.find((item)=>{\r\n            return item.id == userID.userId\r\n        })\r\n        let ret\r\n        if(user== undefined){\r\n            console.log(user)\r\n            ret='deleted User'\r\n        }\r\n        else{\r\n            ret=user.name\r\n        }\r\n        return ret\r\n    }\r\n\r\n    //____________________________\r\n\r\n    const fetchChatData = (roomname) => {\r\n        \r\n        fetch('https://gruppe13.toni-barth.com/rooms/'+roomname+'/chat', {\r\n            method:'GET'\r\n        }).then((res) =>\r\n        res.json()).then((response)=> {\r\n            getChatData(response.messages);\r\n        \r\n        })\r\n        \r\n    }\r\n\r\n    const fetchUserData = (roomname) => {\r\n\t\tfetch('https://gruppe13.toni-barth.com/rooms/' + roomname + '/users')\r\n\t\t\t.then((res) =>\r\n\t\t\t\tres.json())\r\n\t\t\t.then((response) => {\r\n\t\t\t\tgetUserData(response.users);\r\n                \r\n\t\t\t})\r\n\r\n\t}\r\n    \r\n  return (\r\n    <div className='ChatBox'>\r\n        <div className='messageBox'>\r\n\t\t\t{messageList.map( line => <ul className='massage' key={line.time}>{line.author+': '+line.text}</ul>)}\r\n        </div>\r\n        <div className='ChatSubmitbar'>\r\n            <input type=\"text\"  class=\"message_submit\" placeholder=\"Nachricht schreiben\" value={message} onChange={(change) => setMessage(change.target.value)}></input>\r\n            <button onClick={event => handleButton()} className=\"message_submit_button\">Senden</button>\r\n       \r\n        </div>\r\n    </div>\r\n    \r\n  )\r\n}\r\n\r\nexport default Chat"],"mappings":"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"},"metadata":{},"sourceType":"module"}